# Insights (High-Impact Only)

## 2026-02-20
- QA-PASS closure lag created rework loops; governance now requires immediate Lead PASS/FAIL after QA signal to prevent duplicate implementation cycles.
- Sprint throughput dropped when tasks were decomposed into micro-steps; execution should run in 3-step packets (build, follow-up, validate) per active TASK.
- Planning artifacts became noisy when they mixed audit history with live execution state; keep sprint-board/backlog operational and move historical detail to audit/regression records only.
- Scope drift risk increases when PM/Lead/Dev boundaries blur; PM remains allocation/governance only, Lead owns technical directives, Dev owns code changes.
- Browser backend drift caused tool confusion; agent-browser policy must stay explicit and enforced before runtime validation.

## Operating Rule
- Add only decisions that change future behavior, reduce cycle time, or prevent regressions. Do not log routine sync/status events.
- Sync-and-continue executed under ACTIVE TASK-008 updated packet (data-driven assignment + decision traces + deterministic artifacts).
- Implemented data-driven enemy skill assignment and threshold decision model in runtime path:
  - `/Users/Mace/Wishfire/Codex-Orka/web-runner/modules/functionBank.js`
  - Added `ENEMY_SKILL_ASSIGNMENT_MAP`, `resolveEnemySkillDecision(...)`, and decision trace capture in `PickEnemySkill(...)`.
  - Added `GetEnemySkillAssignmentMap()` for deterministic QA artifact extraction.
- Mirrored assignment/decision logic to `/Users/Mace/Wishfire/Codex-Orka/Scripts/functionBank.js` for source parity.
- Published deterministic TASK-008 artifacts under `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/`:
  - `assignment-map.json`
  - `decision-traces.json`
  - `refill-turn-trace.json`
  - `refill-sequencing-assertions.json`
  - `layout1-skill-check.png`
- Assertions confirm:
  - QA coverage for Djinn/Marid/Chimerilass skill decisions.
  - Special vs regular thresholds match expected ratio pattern.
  - Drain Buff/X Out/Wipe runtime effects pass deterministic checks.
- Files touched:
  - `/Users/Mace/Wishfire/Codex-Orka/web-runner/modules/functionBank.js`
  - `/Users/Mace/Wishfire/Codex-Orka/Scripts/functionBank.js`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/assignment-map.json`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/decision-traces.json`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/refill-turn-trace.json`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/refill-sequencing-assertions.json`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/layout1-skill-check.png`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/todo.md`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/insights.md`
- Next: Await next explicit user request.
- Continued TASK-008 under ACTIVE intake and finalized Lead closure artifact packaging.
- Added `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/closure-recommendation.json` with PASS recommendation and deterministic artifact index.
- No scope expansion and no additional runtime behavior changes in this continuation step.
- Files touched:
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/closure-recommendation.json`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/todo.md`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/insights.md`
- Next: Await next explicit user request.
- Applied surgical Wipe behavior adjustment per user directive:
  - `Enemy_Wipe` now consumes only light-green gems (color 4), not all gems.
  - Heal pool now equals `lightGreenConsumed * 4`, split deterministically across living enemies.
- Runtime file updated:
  - `/Users/Mace/Wishfire/Codex-Orka/web-runner/modules/functionBank.js`
- Source parity file updated:
  - `/Users/Mace/Wishfire/Codex-Orka/Scripts/functionBank.js`
- Self-validation artifacts:
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/wipe-lightgreen-check.json`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/wipe-lightgreen-check-seeded.json`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/wipe-lightgreen-assertions.json` (pass=true)
- Next: Await next explicit user request.
- Reopened TASK-008 closure gate due new QA regression signal: initial refill shows frame/state swap contamination with suspected yellow-path bleed into regular non-yellow refill.
- Updated dispatch artifacts:
  - `/Users/Mace/Wishfire/Codex-Orka/governance/execution/dev-directives/TASK-008-execution-plan.md` -> closure gate set to `PARTIAL PASS (REOPENED)` with corrective packet.
  - `/Users/Mace/Wishfire/Codex-Orka/governance/execution/dev-directives/ACTIVE.md` -> 3-step corrective Dev packet for reproduce/fix/validate.
- Scope lock: no transition-flow edits, no unrelated gameplay logic changes; target is regular refill stability and yellow-path isolation only.
- Next: Await Dev corrective artifact packet for Lead closure re-check.
- Executed reopened TASK-008 corrective packet for initial refill frame/state swap contamination (yellow-path isolation).
- Minimal corrective fix in `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js`:
  - `startYellowCasinoSequence(...)` now queues only `type:'yellow'` items.
  - Removed yellow-sequence `empty` queue entries to isolate regular refill path from yellow animation path.
  - Lock/defer is now only applied when yellow queue has work; otherwise immediate fallback to `startRefillBounce()`.
- Deterministic reopened artifacts published under `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/`:
  - `reopened-repro-start.json`
  - `reopened-repro-console.log`
  - `reopened-repro-post.json`
  - `reopened-repro-frame.png`
  - `reopened-refill-trace.json`
  - `reopened-refill-assertions.json`
- Assertion result: PASS for non-yellow anchor, zero yellow-sequence markers after non-yellow resolve anchor, and board remains populated post-action.
- Additional test-hook correction:
  - `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js` `__codexGame.selectGemByRC` now records selected gem index (runtime parity with click path) instead of UID.
- Files touched:
  - `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/reopened-repro-start.json`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/reopened-repro-console.log`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/reopened-repro-post.json`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/reopened-repro-frame.png`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/reopened-refill-trace.json`
  - `/Users/Mace/Wishfire/Codex-Orka/test-results/task008/reopened-refill-assertions.json`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/todo.md`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/insights.md`
- Next: Await next explicit user request.
- TASK-008 reopen corrective packet reviewed and closed with Lead PASS.
- Refill regression evidence confirms non-yellow regular refill no longer triggers yellow-sequence markers after non-yellow resolve anchor.
- Directive sync updated:
  - `/Users/Mace/Wishfire/Codex-Orka/governance/execution/dev-directives/TASK-008-execution-plan.md`
  - `/Users/Mace/Wishfire/Codex-Orka/governance/execution/dev-directives/ACTIVE.md`
- Note captured: `reopened-repro-start.json` path referenced by Dev is missing, but closure evidence remained sufficient via trace/log/post-state artifacts.

## 2026-02-20 (startup refill diagnostics)
- Added startup `Layout 1` refill diagnostics in `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js` with no gameplay logic changes:
  - `[LAYOUT1_REFILL_START]` logs full board array snapshot at refill start.
  - `[LAYOUT1_REFILL_STEP]` logs board array at each refill queue step (`skip`/`occupied`/`set`).
  - `[LAYOUT1_REFILL_FINISH]` logs final board array plus deterministic start-vs-final cell diff and `BattleStartMode` (`initiative`/`ambush`) for leakage checks.
- Capture is scoped to first combat-layout startup refill per runtime session to keep output focused.
- Index gap recorded: `ai-memory/PROJECT_INDEX.md` is missing; direct file discovery was used for this task.
- Files touched:
  - `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/todo.md`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/insights.md`
- Next: Await next explicit user request.

## 2026-02-20 (diagnostic cleanup after QA PASS)
- Removed temporary startup refill diagnostics from `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js`:
  - deleted `[LAYOUT1_REFILL_START]`, `[LAYOUT1_REFILL_STEP]`, `[LAYOUT1_REFILL_FINISH]` logs
  - deleted audit helper functions used only by those logs
  - removed temporary refill-audit state wiring in `startRefillBounce(...)`
- No gameplay behavior changes applied; refill/turn flow logic unchanged.
- Files touched:
  - `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/todo.md`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/insights.md`
- Next: Await next explicit user request.

## 2026-02-20 (startup log condensation)
- Condensed startup render debug spam in `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js` by replacing four repeated modal/window debug lines with one deduplicated summary log:
  - New tag: `[DEBUG_RENDER_SUMMARY]`
  - Emits only when render/modal signature changes.
- This is logging-only; no gameplay/UI behavior changes.
- Files touched:
  - `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/todo.md`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/insights.md`
- Next: Await next explicit user request.

## 2026-02-20 (startup debug efficiency pass)
- Added startup debug gate in `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js`:
  - `STARTUP_DEBUG` query flag (`?startup_debug=1`)
  - `startupDebugLog(...)` helper
- Routed high-volume startup diagnostics to gated logger:
  - `[HP_FIX]`, `[LAYOUT_AUDIT]`, `[INIT]` startup chatter, per-asset `[LOAD] SUCCESS`, `[DEBUG_RENDER_SUMMARY]`, and `[FILTER]` chatter.
- Kept warnings/errors and key non-debug runtime logs unchanged.
- Files touched:
  - `/Users/Mace/Wishfire/Codex-Orka/web-runner/app.js`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/todo.md`
  - `/Users/Mace/Wishfire/Codex-Orka/ai-memory/insights.md`
- Next: Await next explicit user request.
